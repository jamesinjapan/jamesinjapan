<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <title>Improving upon the Javascript Calculator</title>
  
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Simpson's Corner" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Simpson&#39;s Corner</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="featured-image-banner"  style="background-image: url('/assets/fixed-javascript-calculator.jpg');" ></div>
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Improving upon the Javascript Calculator</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-06-09T23:00:00+09:00" itemprop="datePublished">Jun 9, 2018
      </time></p>
  </header><div id="toc"> 
      <p id="toc_title">Contents</p>
      <ul>
  <li><a href="#fixing-the-background-image">Fixing the background image</a></li>
  <li><a href="#making-the-calculator-responsive">Making the calculator responsive</a></li>
  <li><a href="#fixing-the-calculators-display">Fixing the calculator’s display</a></li>
  <li><a href="#limiting-number-length">Limiting number length</a></li>
</ul>
    </div><div class="post-content e-content" itemprop="articleBody">
    <p>Last week I made <a href="https://codepen.io/jamesinjapan/full/dKGyWP/" rel="nofollow" target="_blank">a basic javascript calculator on CodePen</a>. After waking up and trying to check the CodePen on my iPhone, I was immediately presented with a white background and a calculator that didn’t fit on my phone’s browser. I guess the lesson is to always check on alternate browsers and systems, but I made the original CodePen entirely on my Windows PC with Firefox and I didn’t check it when I published early Monday morning.</p>

<p>So, we need to fix that background issue and make the calculator responsive so it works on every size of screen. I also found out that when you multiply a 12 digit number (the digit limit of the calculator was meant to be 12), you end up with 13 digits. So that needs to be fixed too.</p>

<p>Here is the finished product:</p>

<p data-embed-version="2" data-height="800" data-preview="false" data-theme-id="11473" data-default-tab="result" data-user="jamesinjapan" data-slug-hash="dKGyWP" class="codepen">See the <a href="https://codepen.io/jamesinjapan/pen/dKGyWP/" rel="nofollow" target="_blank">pen</a> on <a href="//codepen.io">CodePen</a>.</p>
<script async="" src="https://production-assets.codepen.io/assets/embed/ei.js"></script>

<h2 id="fixing-the-background-image">Fixing the background image</h2>

<p>So, why was the background image disappearing on my iPhone? Well it all comes down to Imgur blocking CodePen referrals.</p>

<div class="jekyll-twitter-plugin">
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">Imgur blocks image requests from CodePen. We can't control that.<br><br>We offer Asset Hosting that we absolutely support! <a href="https://t.co/eKTxff3hfu" rel="nofollow" target="_blank">https://t.co/eKTxff3hfu</a></p>— CodePen.IO (@CodePen) <a href="https://twitter.com/CodePen/status/662641042647326720?ref_src=twsrc%5Etfw" rel="nofollow" target="_blank">November 6, 2015</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>

<p>But it took me a while to realise that, so I spent a while fiddling around with different background options to no avail. Finally, I settled on this:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
<td class="code"><pre><span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">440px</span><span class="p">)</span> <span class="p">{</span>
  <span class="nt">body</span> <span class="p">{</span>
    <span class="nl">background</span><span class="p">:</span> <span class="sx">url('https://res.cloudinary.com/du8zlow0n/image/upload/v1528561905/uteTbQQ.jpg')</span> <span class="nb">no-repeat</span> <span class="nb">top</span> <span class="nb">center</span> <span class="nb">fixed</span><span class="p">;</span>
    <span class="nl">-webkit-background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
    <span class="nl">-moz-background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
    <span class="nl">-o-background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
    <span class="nl">background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">439px</span><span class="p">)</span> <span class="p">{</span>
  <span class="nt">body</span> <span class="p">{</span>
    <span class="nl">background</span><span class="p">:</span> <span class="sx">url('https://res.cloudinary.com/du8zlow0n/image/upload/v1528597854/uteTbQQ_mob.jpg')</span> <span class="nb">no-repeat</span> <span class="nb">top</span> <span class="nb">center</span> <span class="nb">fixed</span><span class="p">;</span>
    <span class="nl">-webkit-background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
    <span class="nl">-moz-background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
    <span class="nl">-o-background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
    <span class="nl">background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>The first block serves a 1920x1200 px background to screens over 440px in width. 440px is about the point at which the calculator starts to resize when its max-width is set to 400px (see below).</p>

<p>The second media query issues a cropped portrait 600×1274px image with reduced bandwidth cost, ensuring that the calculator doesn’t overlap other things on the desk at lower widths. You can also see I used Cloudinary to serve the images, rather than Imgur.</p>

<p>These changes have been added to the original post.</p>

<h2 id="making-the-calculator-responsive">Making the calculator responsive</h2>

<p>So the calculator fits on my iPhone (now!) because I edited the widths to make it fit, but it is fixed at 325px. This works fine at all but the smallest resolution, so perhaps we can focus on making the calculator resize nicely between 400 and 200px just to show off its responsiveness.</p>

<p>First we need to edit the container:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="code"><pre><span class="nf">#container</span> <span class="p">{</span>
  <span class="err">...</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">400px</span><span class="p">;</span>
  <span class="nl">min-width</span><span class="p">:</span> <span class="m">200px</span><span class="p">;</span>
  <span class="err">...</span>
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>This will make the container no larger than 400px and no smaller than 200px.</p>

<p>Next we make sure our buttons respond to changes in width as well:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="code"><pre><span class="nc">.button</span> <span class="p">{</span>
  <span class="err">...</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">20%</span><span class="p">;</span>
  <span class="err">...</span>
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>So our buttons and calculator as a whole will adjust size with the browser window width, but that was just the easy part. The text size for both the buttons and display needs to adjust too.</p>

<table class="wrap-table">
  <tbody>
    <tr>
      <td><img src="/assets/javascript-calc-bugfix-text-above-380.png" alt="Calculator above window width 380px"></td>
      <td><img src="/assets/javascript-calc-bugfix-text-below-380.png" alt="Calculator below window width 380px"></td>
    </tr>
    <tr>
      <td>Calculator @ width &gt; 380px</td>
      <td>Calculator @ width &lt; 380px</td>
    </tr>
  </tbody>
</table>

<p>Before we make our font size responsive, let’s fix the title display of the calculator.</p>

<p>Currently it says “JAVASCRIPT CALCULATOR” which is far longer than the display will handle for numbers. Let’s make the title “JS CALCULATOR”. This will remove the need for use to hardcode a new font size when we initially enter a value into the calculator.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="code"><pre><span class="kd">function</span> <span class="nx">clearDisplay</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">clearedValue</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="nx">calculatorDisplay</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">clearedValue</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">clearedValue</span><span class="p">;</span>
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>Now onto the font sizes of the buttons and titles. We need the text size to change when the window width drops below our 440px breakpoint, so first, let’s add the existing font-size declarations to the large media query:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="code"><pre><span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">440px</span><span class="p">)</span> <span class="p">{</span>
  <span class="nt">body</span> <span class="p">{</span>
    <span class="err">...</span>
  <span class="p">}</span>
  
  <span class="nf">#display</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">43px</span><span class="p">;</span>
  <span class="p">}</span>  
  
  <span class="nc">.button</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>Next, let’s go to our lowest point of deformation, 240px. This is the smallest the calculator will get:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="code"><pre><span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">240px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#display</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">17px</span><span class="p">;</span>
  <span class="p">}</span>  
  
  <span class="nc">.button</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">18px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>Okay, now we need a media query to handle the size of the font between these two breakpoints. The best way to handle this is to work out the linear trendline between these two points. If we plug these maximum and minimum widths and font-sizes into Excel, create a scattergraph and add a linear trendline, we get something like this:</p>

<table class="wrap-table">
  <tbody>
    <tr>
      <td><img src="/assets/javascript-calc-bugfix-text-trendline.png" alt="Linear trendline for button and display font-sizes"></td>
    </tr>
  </tbody>
</table>

<p>We can now calculate y in a new media query using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/calc" rel="nofollow" target="_blank">calc()</a>, a CSS native function that allows you to add, subtract, divide and multiply values.</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="code"><pre><span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">240px</span><span class="p">)</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">439px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#display</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">13vw</span> <span class="n">-</span> <span class="m">14.2px</span><span class="p">);</span>
  <span class="p">}</span>  
  
  <span class="nc">.button</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">6vw</span> <span class="err">+</span> <span class="m">3.6px</span><span class="p">);</span>
  <span class="p">}</span> 
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>At this stage, in Firefox on my desktop, this all looks great.</p>

<p>On my phone however, we have a problem:</p>

<table class="wrap-table">
  <tbody>
    <tr>
      <td><img src="/assets/javascript-calc-bugfix-iphone-titlesize.png" alt="Title line break on iPhone"></td>
    </tr>
  </tbody>
</table>

<p>So to fix this I found out the window size on the iPhone by calling:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
</pre></td>
<td class="code"><pre><span class="nx">calculatorDisplay</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">;</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>This showed that the inner width of the browser window on my iPhone was 375px. So I added this point to my graph, along with the maximum font-size in whole pixels that would fit on a single line at that width:</p>

<table class="wrap-table">
  <tbody>
    <tr>
      <td><img src="/assets/javascript-calc-bugfix-iphone-trendline.png" alt="Linear trendline for display and button font-sizes with iPhone size included"></td>
    </tr>
  </tbody>
</table>

<p>Exponential calculations are not possible using calc(), so non-linear relationships can’t be plotted, but what we can do is create a new breakpoint to mimic the change in rate in an exponential equation. I added a new breakpoint at 375 px so that on the iPhone it would look just right.</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
<td class="code"><pre><span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">375px</span><span class="p">)</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">439px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#display</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">16.9vw</span> <span class="n">-</span> <span class="m">31.5px</span><span class="p">);</span>
  <span class="p">}</span>  
  
  <span class="nc">.button</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
  <span class="p">}</span> 
<span class="p">}</span>

<span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">240px</span><span class="p">)</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">374px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#display</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">11.1vw</span> <span class="n">-</span> <span class="m">9.7px</span><span class="p">);</span>
  <span class="p">}</span>  
  
  <span class="nc">.button</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">8.9vw</span> <span class="n">-</span> <span class="m">3.3px</span><span class="p">);</span>
  <span class="p">}</span> 
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>The buttons looked just fine at 30px from 375 px width, so I set a fixed size. Adding this extra breakpoint has made the whole reponse far smoother. Whereas at smaller widths with the single scaling breakpoint, the lower font-size didn’t seem to match when breaking, now it is much closer in size.</p>

<p>Additionally, on IE, I spotted a different issue: all the buttons were aligned to the left of the row divs. Apparently justify: space-evenly isn’t supported by IE so I changed that to space-around to fix that issue.</p>

<p>There is one issue left to fix regarding responsiveness: the size of the display. It looks just right at full size, but as the calculator resizes, the text is forced upwards to as the height of the display remains unchanged despite the reduced font-size.</p>

<h2 id="fixing-the-calculators-display">Fixing the calculator’s display</h2>

<p>First I removed the height declarations from .button, .row and #display-container, as well as .line-height from #display and .button. We will add them into the different breakpoints as appropriate.</p>

<table class="wrap-table">
  <tbody>
    <tr>
      <td><img src="/assets/javascript-calc-bugfix-line-trendline.png" alt="Linear trendline for display and button line-heights"></td>
    </tr>
  </tbody>
</table>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td>
<td class="code"><pre><span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">440px</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">#display</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">43px</span><span class="p">;</span>
    <span class="nl">line-height</span><span class="p">:</span> <span class="m">36px</span><span class="p">;</span>
  <span class="p">}</span>  
  
  <span class="nc">.button</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
    <span class="nl">line-height</span><span class="p">:</span> <span class="m">50px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">375px</span><span class="p">)</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">439px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#display</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">16.9vw</span> <span class="n">-</span> <span class="m">31.5px</span><span class="p">);</span>
    <span class="nl">line-height</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">18.5vw</span> <span class="n">-</span> <span class="m">45.2px</span><span class="p">);</span>
  <span class="p">}</span>  
  
  <span class="nc">.button</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
    <span class="nl">line-height</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">18.5vw</span> <span class="n">-</span> <span class="m">31.2px</span><span class="p">);</span>
  <span class="p">}</span> 
<span class="p">}</span>

<span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">240px</span><span class="p">)</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">374px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#display</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">11.1vw</span> <span class="n">-</span> <span class="m">9.7px</span><span class="p">);</span>
    <span class="nl">line-height</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">10.3vw</span> <span class="n">-</span> <span class="m">14.9px</span><span class="p">);</span>
  <span class="p">}</span>  
  
  <span class="nc">.button</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">8.9vw</span> <span class="n">-</span> <span class="m">3.3px</span><span class="p">);</span>
    <span class="nl">line-height</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">7.4vw</span> <span class="err">+</span> <span class="m">10.2px</span><span class="p">);</span>
  <span class="p">}</span> 
<span class="p">}</span>

<span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">240px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#display</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">17px</span><span class="p">;</span>
    <span class="nl">line-height</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="p">}</span>  
  
  <span class="nc">.button</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">18px</span><span class="p">;</span>
    <span class="nl">line-height</span><span class="p">:</span> <span class="m">28px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>Finally, let’s just do the same for the memory icon.</p>

<table class="wrap-table">
  <tbody>
    <tr>
      <td><img src="/assets/javascript-calc-bugfix-memory-trendline.png" alt="Linear trendline for memory icon font-size"></td>
    </tr>
  </tbody>
</table>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
<td class="code"><pre><span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">440px</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">#memoryIcon</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">375px</span><span class="p">)</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">439px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#memoryIcon</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">7.7vw</span> <span class="n">-</span> <span class="m">13.8px</span><span class="p">);</span>
  <span class="p">}</span>  
<span class="p">}</span>

<span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">240px</span><span class="p">)</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">374px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#memoryIcon</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">2.2vw</span> <span class="err">+</span> <span class="m">6.7px</span><span class="p">);</span>
  <span class="p">}</span>  
<span class="p">}</span>

<span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">max-width</span><span class="p">:</span> <span class="m">240px</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nf">#memoryIcon</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>Okay, now we have all our CSS fixed, now we can focus on fixing our javascript.</p>

<h2 id="limiting-number-length">Limiting number length</h2>

<p>We have twelve digits to play with, but we can do a lot more using exponentials. In the current setup, an exponential will be displayed once the digit length exceeds 21 digits (e.g. 9.99999999999e+21). However, this gives us 17 digits, far too many for our display. So, we need to check when the result will exceed 12 digits and convert it into an exponential with appropriate precision.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
<td class="code"><pre><span class="kd">function</span> <span class="nx">prepareOperation</span><span class="p">(</span><span class="nx">elementId</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">firstValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="nx">performCalculation</span><span class="p">(</span><span class="nx">elementId</span><span class="p">);</span> 
    <span class="kd">var</span> <span class="nx">formattedResult</span> <span class="o">=</span> <span class="nx">formatResult</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">formattedResult</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">calculatorDisplay</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">formattedResult</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">elementId</span> <span class="o">===</span> <span class="s1">'calculate'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resetVariableList</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">firstValue</span> <span class="o">=</span> <span class="nx">formattedResult</span><span class="p">;</span>
        <span class="nx">operator</span> <span class="o">=</span> <span class="nx">elementId</span><span class="p">;</span>
        <span class="nx">clearDisplayFlag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">operator</span> <span class="o">=</span> <span class="nx">elementId</span><span class="p">;</span>
    <span class="nx">firstValue</span> <span class="o">=</span> <span class="nx">getDisplayValue</span><span class="p">();</span>
    <span class="nx">clearDisplayFlag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>  
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">formatResult</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">result</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">exponential</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">toExponential</span><span class="p">();</span> 
    <span class="kd">var</span> <span class="nx">separated_parts</span> <span class="o">=</span> <span class="nx">exponential</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">'e'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">exponent_length</span> <span class="o">=</span> <span class="nx">separated_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">toExponential</span><span class="p">(</span><span class="mi">9</span> <span class="o">-</span> <span class="nx">exponent_length</span><span class="p">);</span> 
  <span class="p">}</span>
<span class="p">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>So before we assign the result to the display, we format it with formatResult(). This function checks if the result is longer that 12 digits, and if it is then it converts it to an exponential. toExponential() has an optional argument which is the number of decimal places. To set this, we need to know how much space is left to play with.</p>

<p>We convert the exponential to a string and split it at the exponent marker “e”. This gives the length of the number and the length of the exponent. We know that in addition to the length of the exponent, we will also have to add back the “e” and that there will also be an integer and a decimal point. We then return the original result, this time converting to an exponential with the desired precision.</p>

  </div>

  <div class="post-comments"><div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = "https://jamesinjapan.github.io/2018/06/09/improving-javascript-calculator";
this.page.identifier = "/2018/06/09/improving-javascript-calculator";
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://personalgithubpage.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>

  <a class="u-url" href="/2018/06/09/improving-javascript-calculator" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Simpson&#39;s Corner</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">James Simpson</li><li><a class="u-email" href="mailto:jamesdanielsimpson@gmail.com">jamesdanielsimpson@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jamesinjapan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jamesinjapan</span></a></li><li><a href="https://www.linkedin.com/in/jamesdanielsimpson"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">jamesdanielsimpson</span></a></li><li><a href="https://www.twitter.com/jamesinjapan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jamesinjapan</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A personal web development blog for an amateur looking to turn pro.</p>
      </div>
    </div>

  </div>

</footer>
<script id="dsq-count-scr" src="//personalgithubpage.disqus.com/count.js" async></script>
  </body>

</html>
